/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var W=Object.defineProperty;var q=Object.getOwnPropertyDescriptor;var G=Object.getOwnPropertyNames;var J=Object.prototype.hasOwnProperty;var K=(g,e)=>{for(var n in e)W(g,n,{get:e[n],enumerable:!0})},Y=(g,e,n,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of G(e))!J.call(g,r)&&r!==n&&W(g,r,{get:()=>e[r],enumerable:!(t=q(e,r))||t.enumerable});return g};var Z=g=>Y(W({},"__esModule",{value:!0}),g);var ee={};K(ee,{default:()=>R});module.exports=Z(ee);var X=require("obsidian");var z=require("obsidian");typeof globalThis.__DEV__=="undefined"&&(globalThis.__DEV__=!0);var _=class{getTextChain(e,n){return e.find(t=>t.from<=n&&n<=t.to)}getTextChains(e,n,t){return e.filter(r=>r.from<=n&&r.to>=n||r.from<=t&&r.to>=t)}getClearPosition(e,n,t){let r=-1,o=-1,i=new T,[s,a]=i.getTags(n);for(let l=0;l<t.length;l++){let d=t[l],c=!1;(d.type==s||d.type==a)&&(c=!0);for(let u=0;u<d.content.length;u++)if(o++,c||r++,o==e)return r}return r}getPositionByClearPosition(e,n){let t=-1,r=-1;for(let o=0;o<n.length;o++){let i=n[o],s=!1;if(!i.isDelete){(i.type=="bold_open"||i.type=="bold_close")&&(s=!0);for(let a=0;a<i.content.length;a++)if(t++,s||r++,r==e)return t}}return t}parseLine(e,n=0,t){let r=[],i=new T().getAll(),s=0,a=0,l=!1,d=new Map;for(;s<e.length;){let u=!1;if(i.forEach(h=>{if(u)return;let{openToken:x,closeToken:f}=h;if(!x||!f)throw new Error("Source tokens for bold not found");let m=x.content,p=m.length,w=[m];if(l=d.has(h.markerAction)?d.get(h.markerAction):!1,e.startsWith(m,s)){let C=f.content.length-1;if(u=!0,l){if(s+p==e.length||e[s-1]!=" "){let L=new y(f.type,s,s+C,f.content);if(s!=0&&a!=s){let b=e.substring(a,s),v=new y("text",a,s-1,b);r.push(v)}r.push(L),a=s+p,s+=p,d.delete(h.markerAction)}}else if(e[s+p]!=" "&&s+p<e.length){if(d.set(h.markerAction,!0),s!=0&&a!=s){let b=e.substring(a,s),v=new y("text",a,s-C,b);r.push(v)}let L=new y(x.type,s,s+1,x.content);r.push(L),a=s+p,s+=p,d.set(h.markerAction,!0)}else s+=p}}),s==e.length-1){let h=e.substring(a),x=new y("text",a,s,h);r.push(x),s+=h.length}u||s++}this.markeredTokens(r,"bold"),this.markeredTokens(r,"italic"),this.markeredTokens(r,"highlight"),this.markeredTokens(r,"strikethrough"),this.markeredTokens(r,"code");let c=0;for(let u=0;u<r.length;u++){let h=r[u];h.from=c,h.content.length>1&&(c+=h.content.length-1),h.to=c,c++}for(let u=0;u<r.length;u++){let h=r[u];n!==void 0&&h.from<=n&&h.to>=n&&(h.fromSelectedPosition=n-h.from),t!==void 0&&h.from<=t&&h.to>=t&&(h.toSelectedPosition=t-h.from)}return r}markeredTokens(e,n){let t=new T,{openToken:r,closeToken:o}=t.getSourceTokens(n),i=!1;for(let s=0;s<e.length;s++){let a=e[s];a.type==r.type&&(i=!0),n=="bold"?a.isBold=i:n=="italic"?a.isItalic=i:n=="highlight"?a.isHighlight=i:n=="strikethrough"?a.isStrikethrough=i:n=="code"&&(a.isCode=i),a.type==o.type&&(i=!1)}}};var y=class{constructor(e,n=-1,t=-1,r,o=!1,i,s){this.content=r||"",e=="bold_open"&&(this.isBold=!0,this.content="**"),e=="bold_close"&&(this.isBold=!1,this.content="**"),e=="italic_open"&&(this.isBold=!1,this.content="*"),e=="italic_close"&&(this.isBold=!1,this.content="*"),e=="highlight_open"&&(this.isBold=!1,this.content="=="),e=="highlight_close"&&(this.isBold=!1,this.content="=="),e=="strikethrough_open"&&(this.isBold=!1,this.content="~~"),e=="strikethrough_close"&&(this.isBold=!1,this.content="~~"),e=="code_open"&&(this.isBold=!1,this.content="`"),e=="code_close"&&(this.isBold=!1,this.content="`"),e=="comment_open"&&(this.isBold=!1,this.content="%%"),e=="comment_close"&&(this.isBold=!1,this.content="%%"),this.from=n==null?-1:n,this.to=t==null?-1:t,this.type=e,this.isDelete=!1,this.isNew=o||!1,this.isBold=!1,this.fromSelectedPosition=i,this.toSelectedPosition=s,(e=="bold_open"||e=="bold_close")&&(this.markerAction="bold"),(e=="italic_open"||e=="italic_close")&&(this.markerAction="italic"),(e=="highlight_open"||e=="highlight_close")&&(this.markerAction="highlight"),(e=="strikethrough_open"||e=="strikethrough_close")&&(this.markerAction="strikethrough"),(e=="code_open"||e=="code_close")&&(this.markerAction="code"),(e=="comment_open"||e=="comment_close")&&(this.markerAction="comment")}isOpenMarker(){return this.type=="bold_open"||this.type=="italic_open"||this.type=="highlight_open"||this.type=="strikethrough_open"||this.type=="code_open"||this.type=="comment_open"}isCloseMarker(){return this.type=="bold_close"||this.type=="italic_close"||this.type=="highlight_close"||this.type=="strikethrough_close"||this.type=="code_close"||this.type=="comment_close"}isTextMarker(){return(this.isItalic||this.isHighlight||this.isStrikethrough||this.isCode||this.isComment||this.isBold)&&this.type=="text"}},T=class g{constructor(){this.sourceTokens=[];this.sourceTokens=[],this.sourceTokens.push({type:"bold_open",content:"**"}),this.sourceTokens.push({type:"bold_close",content:"**"}),this.sourceTokens.push({type:"italic_open",content:"*"}),this.sourceTokens.push({type:"italic_close",content:"*"}),this.sourceTokens.push({type:"highlight_open",content:"=="}),this.sourceTokens.push({type:"highlight_close",content:"=="}),this.sourceTokens.push({type:"strikethrough_open",content:"~~"}),this.sourceTokens.push({type:"strikethrough_close",content:"~~"}),this.sourceTokens.push({type:"code_open",content:"`"}),this.sourceTokens.push({type:"code_close",content:"`"}),this.sourceTokens.push({type:"comment_open",content:"%%"}),this.sourceTokens.push({type:"comment_close",content:"%%"})}getSourceTokens(e){let n=this.sourceTokens.find(r=>r.type==e+"_open"),t=this.sourceTokens.find(r=>r.type==e+"_close");if(!n||!t)throw new Error(`Source tokens for ${e} not found`);return{openToken:n,closeToken:t}}getAll(){let e=[];return["bold","italic","highlight","strikethrough","code","comment"].forEach(t=>{let{openToken:r,closeToken:o}=this.getSourceTokens(t);e.push({openToken:r,closeToken:o,markerAction:t})}),e}markerMultiline(e,n,t){let r=[],o=t.anchor,i=t.head;return(o.line>i.line||o.line===i.line&&o.ch>i.ch)&&([o,i]=[i,o]),n.forEach((s,a)=>{let l=a===0?o.ch:0,d=a===n.length-1?i.ch:s.length-1;if(l===0&&d===-1)return;let c=this.markerMarkerAction(e,s,l,d);r.push(c)}),r}findDotPosition(e){let n=e.indexOf("."),t=e.indexOf("?"),r=Math.min(n===-1?Number.MAX_VALUE:n,t===-1?Number.MAX_VALUE:t);if(e.match(/^(\d+)\.\s?/)){let i=e.indexOf(".",r+1);return i!==-1?i:-1}else return r!==-1?r:-1}getSmartSelection(e,n){let t=e.search(/^(\*\s+|▶|●|♦|-|\d+\.\s+)/),r=e.indexOf(" "),o=this.findDotPosition(e),i=e.indexOf(":"),s=e.length;if(t==0){if(o==-1&&i>-1&&n<=i||o>-1&&i<o&&n<=i)return{from:r+1,to:i-1};if(o===-1||i===-1)return{from:r+1,to:s}}else if(e.search(/^([\w\d ]+):/)===0){let l=e.indexOf(":");if(n<=l)return{from:0,to:l-1}}return{from:n,to:n}}getMarkerPosition(e,n){let r=new _().parseLine(e,n),o=new g,i=o.getChainByPosition(r,n);if((i==null?void 0:i.type)=="text"&&!i.isTextMarker()){let s=this.getSmartSelection(e,n);if(s.from!=s.to)return s}if(i!=null&&i.isOpenMarker()){let s=o.findMarkerCloseAfter(i.markerAction,i,r);if(s)return i.to+1==s.from?{from:i.from,to:s.to}:{from:i.to+1,to:s.from-1}}else if(i!=null&&i.isCloseMarker()){let s=o.findMarkerOpenBefore(i.markerAction,i,r);if(s)return i.from-1==s.to?{from:s.from,to:i.to}:{from:s.to+1,to:i.from-1}}else if((i==null?void 0:i.type)=="text"&&i.isTextMarker())return{from:i.from,to:i.to};return{from:n,to:n}}makerClearOne(e,n){let t=new _,r=e;if(r!=null&&r.isOpenMarker()){let o=this.findTextMarkerAfter(r,n);o&&(r=o)}else if(r!=null&&r.isCloseMarker()){let o=this.findTextMarkerBefore(r,n);o&&(r=o)}r!==void 0&&r.type=="text"&&r.isTextMarker()&&this.getAll().forEach(o=>{this.clearMarkerAction(n,r,o.markerAction)})}makerClear(e,n,t){let r=new _,o=r.parseLine(e,n,t),i=r.getTextChain(o,n),s=r.getTextChain(o,t!==void 0?t:n);if(i!==void 0&&s!==void 0&&i==s&&i.isTextMarker())this.makerClearOne(i,o);else if(i!==void 0&&s!==void 0&&i==s&&!i.isTextMarker()&&i.type=="text"){let d=o.length-1;for(let c=0;c<=d;c++)this.makerClearOne(o[c],o)}else if(i!==void 0&&s!==void 0&&i!==s){let l=o.indexOf(i),d=o.indexOf(s);for(let c=l;c<=d;c++)this.makerClearOne(o[c],o)}return i!==void 0&&s!==void 0&&i==s&&(i.isOpenMarker()||i.isCloseMarker())&&this.makerClearOne(i,o),{lineText:this.optimizeChain(o),fromSelectPosition:0,toSelectPosition:0}}sliceTextChain(e,n,t){let r=e.content.slice(0,n),o=e.content.slice(n),i=e.from+r.length-1,s=e.from+r.length,a;e.fromSelectedPosition!==void 0&&e.fromSelectedPosition<r.length&&(a=e.fromSelectedPosition);let l;e.toSelectedPosition!==void 0&&e.toSelectedPosition>=r.length&&(l=e.toSelectedPosition-r.length);let d=new y("text",e.from,i,r),c=new y("text",s,e.to,o),u=[];return r.length>0&&u.push(d),u.push(t),o.length>0&&u.push(c),u}instertTextChain(e,n,t,r){let[o,i]=this.getTags(n),a=new _().getTextChain(e,r);if(!a)return e;r=r-a.from;let l=e.indexOf(a);if(t.type==o)if(a.type=="text"){let d=a.content;for(;d.charAt(r)==" ";)r++;let c=this.sliceTextChain(a,r,t);e.splice(l,1,...c)}else e.splice(l,0,t);else if(t.type==i)if(a.type=="text"){let d=a.content;for(;d.charAt(r)==" ";)r--;let c=this.sliceTextChain(a,r+1,t);e.splice(l,1,...c)}else e.splice(l+1,0,t)}getTags(e){return e=="bold"?["bold_open","bold_close"]:e=="highlight"?["highlight_open","highlight_close"]:e=="italic"?["italic_open","italic_close"]:e=="strikethrough"?["strikethrough_open","strikethrough_close"]:e=="code"?["code_open","code_close"]:e=="comment"?["comment_open","comment_close"]:[]}createOpenTag(e,n=!1){let[t,r]=this.getTags(e);return new y(t,-1,-1,void 0,n)}createCloseTag(e,n=!1){let[t,r]=this.getTags(e);return new y(r,-1,-1,void 0,n)}getIsFlagByMarkerAction(e,n){return e=="bold"?n.isBold:e=="italic"?n.isItalic:e=="highlight"?n.isHighlight:e=="strikethrough"?n.isStrikethrough:e=="code"?n.isCode:e=="comment"?n.isComment:!1}setFlagByMarkerAction(e,n,t){e=="bold"&&(n.isBold=t),e=="italic"&&(n.isItalic=t),e=="highlight"&&(n.isHighlight=t),e=="strikethrough"&&(n.isStrikethrough=t),e=="code"&&(n.isCode=t),e=="comment"&&(n.isComment=t)}isTogher(e,n,t){let r=t.indexOf(e),o=t.indexOf(n);return Math.abs(o-r)==1}markerMarkerAction(e,n,t,r){let o=new _,i=o.parseLine(n,t,r),s=o.getClearPosition(t,e,i),a=o.getTextChain(i,t),[l,d]=this.getTags(e),c;if(a!==void 0){if(t!==void 0&&r!==void 0){let f=o.getTextChain(i,r);if(f===void 0)throw new Error("ddeieie");let m=this.getIsFlagByMarkerAction(e,a);c=o.getClearPosition(r,e,i);let p=this.getIsFlagByMarkerAction(e,f),w=this.createOpenTag(e,!0),C=this.createCloseTag(e,!0);a==f&&f!==void 0?m?(this.instertTextChain(i,e,C,t-1),this.instertTextChain(i,e,w,r+1)):(this.instertTextChain(i,e,w,t),this.instertTextChain(i,e,C,r)):f!==void 0&&(m&&p&&f!==void 0?this.isTogher(a,f,i)?a.isOpenMarker()&&f.type=="text"?(a.isDelete=!0,this.instertTextChain(i,e,w,r+1)):a.type=="text"&&f.isOpenMarker()?(f.isDelete=!0,this.instertTextChain(i,e,C,t)):a.type=="text"&&f.isCloseMarker()&&(f.isDelete=!0,this.instertTextChain(i,e,C,t)):this.clearByMarkerAction(i,a,f,e):!m&&!p?(this.instertTextChain(i,e,w,t),this.instertTextChain(i,e,C,r)):m&&!p?(this.instertTextChain(i,e,C,r),this.clearMarkerRight(i,a,C,e)):!m&&p&&(this.instertTextChain(i,e,w,t),this.clearMarkerLeft(i,w,f,e)))}else if(t!==void 0&&r==null){if([" ",`
`,"	"].includes(n.charAt(t))&&r==null)return{fromSelectPosition:t,toSelectPosition:t,lineText:n};if(this.getIsFlagByMarkerAction(e,a))this.clearMarkerAction(i,a,e);else if(a.type=="text"){let p=i.indexOf(a),C=a.content.split(" ");C.map(b=>{b==""&&(b=" ")});let L=a.from;for(let b=0;b<C.length;b++){let v=L,$=L+C[b].length-1;if(t>=v&&t<=$){let j=this.createOpenTag(e,!0),Q=this.createCloseTag(e,!0);this.instertTextChain(i,e,j,v),this.instertTextChain(i,e,Q,$);break}L+=C[b].length+1}}}}let u=this.optimizeChain(i),h=0;if(t!==void 0){let f=0;for(let m=0;m<i.length;m++){let p=i[m];if(p.isNew&&(f=f+p.content.length),p.isDelete){f=f-p.content.length;continue}if(p.from<=t+f&&t+f<=p.to){h=t+f,p.type==l&&(h=p.to+1),p.type==d&&(h=p.from-1);break}}}let x=0;if(r!==void 0){let f=0;for(let m=0;m<i.length;m++){let p=i[m];if(p.isNew&&(f=f-p.content.length),p.isDelete){f=f+p.content.length;continue}if(p.from<=r+f&&r+f<=p.to){x=r-f-1,p.type==l&&(x=p.to+1),p.type==d&&(x=p.from-1);break}}}return{fromSelectPosition:h,toSelectPosition:x,lineText:u}}markerBold(e,n,t){return this.markerMarkerAction("bold",e,n,t)}markerItalic(e,n,t){return this.markerMarkerAction("italic",e,n,t)}markerStrikethrough(e,n,t){return this.markerMarkerAction("strikethrough",e,n,t)}deleteChain(e,n,t){let r=e.indexOf(n),o=e.indexOf(t);e.splice(r+1,o-r-1).forEach(i=>{i.type!="text"&&(i.isDelete=!0)})}clearByMarkerAction(e,n,t,r){let o=e.indexOf(n),i=e.indexOf(t),[s,a]=this.getTags(r);for(let l=o;l<=i;l++)(e[l].type==s||e[l].type==a)&&(this.setFlagByMarkerAction(r,e[l],!0),e[l].isDelete=!0),e[l].type=="text"&&this.setFlagByMarkerAction(r,e[l],!0)}clearMarkerRight(e,n,t,r){let[o,i]=this.getTags(r),s=e.indexOf(n),a=e.indexOf(t);for(let l=s+1;l<a;l++)(e[l].type==o||e[l].type==i)&&(e[l].isDelete=!0,this.setFlagByMarkerAction(r,e[l],!1)),e[l].type!="text"&&this.setFlagByMarkerAction(r,e[l],!1)}clearMarkerLeft(e,n,t,r){let[o,i]=this.getTags(r),s=e.indexOf(n),a=e.indexOf(t);for(let l=s+1;l<a;l++)(e[l].type==o||e[l].type==i)&&(this.setFlagByMarkerAction(r,e[l],!1),e[l].isDelete=!0),e[l].type=="text"&&this.setFlagByMarkerAction(r,e[l],!1)}clearMarkerAction(e,n,t){let[r,o]=this.getTags(t),i=e.indexOf(n),s=i,a=i,l=this;function d(h,x){for(let f=x;f>=0&&l.getIsFlagByMarkerAction(t,h[f]);f--)s=f}function c(h,x){for(let f=x;f<h.length&&l.getIsFlagByMarkerAction(t,h[f]);f++)a=f}function u(h,x,f){for(let m=x;m<=f;m++){let p=l.getIsFlagByMarkerAction(t,h[m]);p&&h[m].type=="text"?l.setFlagByMarkerAction(t,h[m],!1):p&&(h[m].type==r||h[m].type==o)&&(h[m].isDelete=!0,l.setFlagByMarkerAction(t,h[m],!1))}}n.type=="text"?(d(e,i),c(e,i),u(e,s,a)):n.type==r?(c(e,i),u(e,s,a)):n.type==o&&(d(e,i),u(e,s,a))}getLineText(e){return e.reduce((n,t)=>t.isDelete?n:n+t.content,"")}recalcFromTo(e){let n=0;e.forEach(t=>{t.isDelete||(t.from=n,n=n+t.content.length,t.to=n-1)})}optimizeChain(e){return this.recalcFromTo(e),this.getAll().forEach(t=>{let r=t.openToken,o=t.closeToken,i=t.markerAction;if(e.length>1)for(let c=0;c<e.length-1;c++){let u=e[c],h=e[c+1];(u.type==o.type&&h.type==r.type||u.type==r.type&&h.type==o.type)&&(u.isDelete=!0,h.isDelete=!0)}let s=0;e.forEach(c=>{let u=c.isOpenMarker()&&!c.isDelete&&c.markerAction==i;c.isCloseMarker()&&c.markerAction==i&&(s=0),u&&s==1&&c.markerAction==i?c.isDelete=!0:u&&s==0&&c.markerAction==i&&(s=1)}),s=0;for(let c=e.length-1;c>=0;c--){let u=e[c];u.isOpenMarker()&&u.markerAction==i&&(s=0);let h=u.isCloseMarker()&&!u.isDelete&&u.markerAction==i;h&&s==1&&u.markerAction==i?u.isDelete=!0:h&&s==0&&u.markerAction==i&&(s=1)}let a=this.getLineText(e),d=new _().parseLine(a);if(d.length>1)for(let c=0;c<e.length-1;c++){let u=d[c],h=d[c+1];u&&h&&u.type==o.type&&h.type==r.type&&(this.removeChain(d,u),this.removeChain(d,h))}e=d}),this.getLineText(e)}removeChain(e,n){let t=e.indexOf(n);t!==-1&&e.splice(t,1)}findBoldCloseAfter(e,n){return this.findMarkerCloseAfter("bold",e,n)}findMarkerCloseAfter(e,n,t){let r=this.createCloseTag(e,!1),o=t.indexOf(n);if(o===-1)return null;for(let i=o+1;i<t.length;i++)if(t[i].type===r.type)return t[i];return null}findBoldOpenBefore(e,n){return this.findMarkerOpenBefore("bold",e,n)}getNextChain(e,n){let t=n.indexOf(e);if(!(t===-1||t<n.length-1))return n[t+1]}getNextChainByTypeAndPositionAndMarkered(e,n,t){let r=t.find(o=>e<o.from&&o.type==n&&o.isTextMarker());return r!=null?r:void 0}getPreviousChainByTypeAndPositionAndMarkered(e,n,t){let r;for(let o of t)e>o.to&&o.type===n&&o.isTextMarker()&&(r=o);return r}getChainByPosition(e,n){let t=e.findIndex(r=>r.from<=n&&n<=r.to);if(t!==-1)return e[t]}getPrevChain(e,n){let t=n.indexOf(e);if(!(t===1||t==0))return n[t-1]}findMarkerOpenBefore(e,n,t){let r=this.createOpenTag(e,!1),o=t.indexOf(n);if(o===-1)return null;for(let i=o;i>=0;i--)if(t[i].type===r.type)return t[i];return null}findTextMarkerBefore(e,n){let t=n.indexOf(e);if(t!==-1){for(let r=t;r>=0;r--)if(n[r].type==="text")return n[r]}}findTextMarkerAfter(e,n){let t=n.indexOf(e);if(t!==-1){for(let r=t;r<n.length;r++)if(n[r].type==="text")return n[r]}}};var A=require("obsidian"),U=require("@codemirror/view"),M=class{constructor(e){this.app=e,this._editor=null,this._activeView=null,this.activeLeaf=null}get editor(){return!this._editor&&this.activeView&&this._activeView.getViewType()==="markdown"&&(this._editor=this._activeView.editor),this._editor||this.getEditorOrThrow()}getEditorOrThrow(){if(!this._editor)throw new Error("Editor not initialized");return this._editor}getNextMarker(e){return this.getMarker("next")}getPreviousMarker(e){return this.getMarker("previous")}getMarker(e){let n=new T,t=new _,r=this.getCursor(),o=r.line,i=r.ch,s=this.editor.lineCount(),a=0;do{let l=this.getLineByNumber(o),d=t.parseLine(l);if(d.length>1){let c;if(e==="next"?c=n.getNextChainByTypeAndPositionAndMarkered(i,"text",d):c=n.getPreviousChainByTypeAndPositionAndMarkered(i,"text",d),c!==void 0&&e==="next")return{line:o,ch:c.from};if(c!==void 0&&e==="previous")return{line:o,ch:c.to}}e==="next"?(i=0,o===this.editor.lastLine()?o=0:o++):(o===0?o=this.editor.lastLine():o--,i=this.editor.getLine(o).length),a++}while(a<s);return r}get activeView(){if(!this._activeView){let e=this.app.workspace.getActiveViewOfType(A.FileView);if(!e||!(e.getViewType()=="markdown"||e.getViewType()=="pdf"))throw new Error("Invalid editor view");this._activeView=e}return this._activeView}replaseLine(e,n){let t=this.getEditorOrThrow(),r=this.getLineByNumber(n);t.replaceRange(e,{line:n,ch:0},{line:n,ch:r.length})}replaseLines(e,n,t){let r=this.getEditorOrThrow(),o=e.join(`
`),i=this.getLineByNumber(t).length;r.replaceRange(o,{line:n,ch:0},{line:t,ch:i})}setCursor(e,n=0){this.editor.setCursor(e.line,e.ch+n)}async getClipboardText(){try{return await navigator.clipboard.readText()}catch(e){console.error("Failed to read clipboard:",e)}}getEditor(){return this.getEditorOrThrow()}getCursor(){return this.editor.getCursor()}getLineByCursor(){return this.editor.getLine(this.editor.getCursor().line)}getLineByNumber(e){return this.editor.getLine(e)}getActiveView(){return this.app.workspace.getActiveViewOfType(z.MarkdownView)}getCodeMirror(e){var n,t,r;return(r=(t=(n=e.editMode)==null?void 0:n.editor)==null?void 0:t.cm)==null?void 0:r.cm}getLinesFromTo(e,n){let t=[];for(let r=e;r<=n;r++)t.push(this.editor.getLine(r));return t}getLines(){return this.editor.getValue().split(`
`)}getEditorView(){let e=this.editor.cm;if(!(e instanceof U.EditorView))throw new Error("Invalid editor view");return e}async splitLiafVertical(e,n=!0,t=!0){let r=this.app.vault.getAbstractFileByPath(e);if(r instanceof A.TFile&&this.activeLeaf){let o=this.app.workspace.createLeafBySplit(this.activeLeaf,"vertical",t);return await o.openFile(r,{active:n}),o}return null}getActiveLeaf(){return this.app.workspace.getActiveViewOfType(z.MarkdownView)}getLeafByTFile(e){return this.getLeafByFilePath(e.path)}getLeafByFilePath(e){let n=null;return this.app.workspace.iterateAllLeaves(t=>{let r=t.getViewState();return(r&&r.state&&r.state.file)===e?(n=t,!0):!1}),n}findHeaderLine(e,n,t){let r=this.getLines();for(let o=e;o>=0&&o<r.length;o+=n){let s=r[o].match(/^(#{1,6})\s/);if(s){let a=s[1].length;if(t!=null&&t>0&&a<=t||t===void 0||a===t||t===-1&&a<t)return o}}if(n===-1){for(let o=r.length-1;o>=0;o--)if(r[o].match(/^(#{1,6})\s/))return o}else if(n===1){for(let o=0;o<r.length;o++)if(r[o].match(/^(#{1,6})\s/))return o}return null}findCurrentHeaderLine(){return this.findHeaderLine(this.editor.getCursor().line,-1)}moveToLineAndScroll(e){this.editor.setCursor(e,0),this.editor.scrollIntoView({from:{line:e,ch:0},to:{line:e,ch:0}})}findNextHeaderLine(){return this.findHeaderLine(this.editor.getCursor().line+1,1)}findPreviousHeaderLine(){return this.findHeaderLine(this.editor.getCursor().line-1,-1)}findNextHeaderWithCurrentLevel(){let e=this.getCurrentHeaderLine(),n=this.getCurrentHeaderLevel();if(e!==null&&n!==null){let t=this.findHeaderLine(e+1,1,n);return t!==null?t:e}return null}findPreviousHeaderWithCurrentLevel(){let n=this.getEditorOrThrow().getCursor().line,t=this.getCurrentHeaderLine(),r=this.getCurrentHeaderLevel();if(n!==t)return t;if(t!==null&&r!==null){let o=this.findHeaderLine(t-1,-1,r);return o!==null?o:t}return null}getCurrentHeaderLevel(){let e=this.findCurrentHeaderLine();if(e!==null){let t=this.getLines()[e].match(/^(#{1,6})\s/);return t?t[1].length:null}return null}getHeaderLevel(e){let t=this.getLines()[e].match(/^(#{1,6})\s/);return t?t[1].length:null}getCurrentHeaderLine(){let n=this.getEditorOrThrow().getCursor().line;return this.findHeaderLine(n,-1)}findHeaderAbove(){let e=this.editor.getCursor().line,n=this.findCurrentHeaderLine();if(n!==null&&n<e)return n;if(n!==null&&n===e){let t=this.getCurrentHeaderLevel();if(t!==null){let r=this.findHeaderLine(e-1,-1,t-1);return r!==null?r:this.findFirstLine()}return null}else{if(n!==null)return null;{let t=this.findFirstLine();this.moveToLineAndScroll(t)}}return null}findFirstLine(){let e=this.getLines(),n=0;for(;n<e.length;)if(e[n].trim()==="---"){for(n++;n<e.length&&e[n].trim()!=="---";)n++;n++}else return n;return n}findPatternLine(e,n,t){let r=this.getLines(),o=new RegExp(`${e}`);for(let i=n;i>=0&&i<r.length;i+=t)if(o.test(r[i]))return i;return null}findPageLine(e,n){return this.findPatternLine("\\{\\d+\\}\\s*-+",e,n)}pageDown(e=20){let n=this.editor.getCursor().line,t=this.findPageLine(n+1,1);if(t!==null)this.moveToLineAndScroll(t+0);else{let r=this.getLines(),o=Math.min(n+e,r.length-1);this.moveToLineAndScroll(o)}return t}pageUp(e=20){let n=this.editor.getCursor().line,t=this.findPageLine(n-1,-1);return t!==null?this.moveToLineAndScroll(t-0):(t=Math.max(n-e,0),this.moveToLineAndScroll(t)),t}};var E=class{constructor(e){this.plugin=e}check(e,n){return n||this.execute(e),!0}getMyPlugin(){return this.plugin}getCommandOfPlugin(e){return this.getMyPlugin().commands.find(n=>n instanceof e)}};var k=class extends E{async executeBase(e,n){var a;let t=this.plugin.currentSelection,r=new M(e),o=new T,i=t&&t[0].anchor.ch!=t[0].head.ch,s=i&&t[0].head;if(i){let l=t[0].head,d=t[0].anchor;l.ch==-1&&(l.ch=0),(l.line>d.line||l.line==d.line&&l.ch>d.ch)&&([l,d]=[d,l]);let c=r.getLinesFromTo(l.line,d.line);if(c.length>1){let m=c[c.length-1];m.length<=d.ch&&(d.ch=m.length-1)}let u={anchor:{ch:l.ch,line:l.line},head:{ch:d.ch-1,line:d.line}},h=o.markerMultiline(n,c,u),x=!1;for(let m=0;m<h.length;m++)m==0&&(l.ch=h[m].fromSelectPosition),m==h.length-1&&(d.ch=(a=h[m].toSelectPosition)!=null?a:h[m].lineText.length),h[m].lineText!=c[m]&&(x=!0);let f=h.map(m=>m.lineText);x&&(r.replaseLines(f,l.line,d.line),t[0].anchor.ch=l.ch,t[0].head.ch=d.ch,r.setCursor(t[0].head))}else{let l=r.getCursor(),d=r.getLineByNumber(l.line),c=o.markerMarkerAction(n,d,l.ch);c.lineText!=d&&(r.replaseLine(c.lineText,l.line),r.setCursor(l,2))}}};var B=class extends k{constructor(){super(...arguments);this.id="next-marker";this.name="Next marker";this.prefix=""}async execute(n){let t=new M(n),r=t.getCursor(),o=t.getNextMarker(r);o&&t.setCursor(o)}};var S=class extends k{constructor(){super(...arguments);this.id="previous-marker";this.name="Previous marker";this.prefix=""}async execute(n){let t=new M(n),r=t.getCursor(),o=t.getPreviousMarker(r);o&&t.setCursor(o)}};var O=class extends k{constructor(){super(...arguments);this.id="clear-marker";this.name="Clear marker";this.prefix=""}async execute(n){let t=new M(n),r=t.getCursor(),o=t.getLineByCursor(),s=new T().makerClear(o,r.ch);s.lineText!=o&&(t.replaseLine(s.lineText,r.line),t.setCursor(r))}};var P=class extends k{constructor(){super(...arguments);this.id="toggle-highlight";this.name="Toggle highlight";this.prefix=""}async execute(n){await this.executeBase(n,"highlight")}};var H=class extends k{constructor(){super(...arguments);this.id="toggle-bold";this.name="Toggle bold";this.prefix=""}async execute(n){await this.executeBase(n,"bold")}};var V=class extends k{constructor(){super(...arguments);this.id="select-marker";this.name="Select marker";this.prefix=""}async execute(n){let t=new M(n),r=t.getCursor(),o=t.getLineByCursor(),s=new T().getMarkerPosition(o,r.ch),a={line:r.line,ch:s.from},l={line:r.line,ch:s.to};o.length>l.ch&&(l.ch+=1),t.editor.setSelection(a,l)}};var F=class extends k{constructor(){super(...arguments);this.id="toggle-comment";this.name="Toggle comment";this.prefix=""}async execute(n){await this.executeBase(n,"comment")}};var D=class extends k{constructor(){super(...arguments);this.id="toggle-italic";this.name="Toggle italic";this.prefix=""}async execute(n){await this.executeBase(n,"italic")}};var I=class extends k{constructor(){super(...arguments);this.id="toggle-strikethrough";this.name="Toggle strikethrough";this.prefix=""}async execute(n){await this.executeBase(n,"strikethrough")}};var N=class extends k{constructor(){super(...arguments);this.id="toggle-code";this.name="Toggle code";this.prefix=""}async execute(n){await this.executeBase(n,"code")}};var R=class extends X.Plugin{constructor(n,t){super(n,t);this.commands=[];this.currentSelection=null;this.pluginName=t.name}async onload(){console.log("loading %s plugin v%s ...",this.manifest.name,this.manifest.version),this.initializePlugin(),this.registerEventHandlers(),this.registerCommands(),console.log(`loaded ${this.pluginName}`)}registerEvents(){this.registerEvent(this.app.workspace.on("active-leaf-change",async()=>{this.updateSelectionEvent()})),this.registerEvent(this.app.workspace.on("file-open",async()=>{this.updateSelectionEvent()}))}async updateSelectionEvent(){let n=new M(this.app),t=n.getActiveView();if(!t)return;let r=n.getCodeMirror(t);r&&(this.getCursorActivityHandlers(r).some(o=>o.name==="updateSelection")||r.on("cursorActivity",async o=>await this.updateSelection(o)))}async updateSelection(n){let t=n.listSelections()[0],r={anchor:{ch:t.anchor.ch,line:t.anchor.line},head:{ch:t.head.ch,line:t.head.line}};this.currentSelection=[r]}getCursorActivityHandlers(n){return n._handlers.cursorActivity}initializePlugin(){}registerEventHandlers(){this.registerEvent(this.app.workspace.on("active-leaf-change",async()=>{this.updateSelectionEvent()})),this.registerEvent(this.app.workspace.on("file-open",async()=>{this.updateSelectionEvent()}))}registerCommands(){this.commands=[new H(this),new N(this),new F(this),new P(this),new D(this),new I(this),new V(this),new B(this),new S(this),new O(this)];try{for(let n of this.commands)n.command=this.addCommand({id:n.id,name:n.name,callback:()=>n.execute(this.app),checkCallback:t=>n.check(this.app,t)})}catch(n){console.error("Error registering commands:",n)}}onunload(){console.log(`onunload ${this.pluginName}`)}};

/* nosourcemap */